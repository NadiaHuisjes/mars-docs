---
layout: scripting
title: "Scriptable chart widgets"
permalink: /tutorials/scripting/scriptable-chart-widgets/index.html
---

Perhaps this should move into docs :)

The widgets available in the various dashboards throughout the Rover allow for rapid evaluation of archive, metadata, and molecule features. All chart widgets leverage the scripting capabilities of ImageJ to provide limitless customizability. Four chart types are available: line, category, bubble, and histogram. Scripts can be written in Python or Groovy. In both cases, chart scripts are provided with a single input that depends on the dashboard.

At the highest level, the global dashboard receives a reference to the entire [MolecleArchive](https://duderstadt-lab.github.io/mars-core/javadoc/de/mpg/biochem/mars/molecule/MoleculeArchive.html) as an input. This provides complete access to all molecules, metadata, and properties, so global relationships can be rapidly evaluated. Dashboards are also provided within the metadata and molecules tabs. These receive [MarsMetadata](https://duderstadt-lab.github.io/mars-core/javadoc/de/mpg/biochem/mars/molecule/MarsMetadata.html) and [Molecule](https://duderstadt-lab.github.io/mars-core/javadoc/de/mpg/biochem/mars/molecule/Molecule.html) references for detailed inspection of individual records. Once a suitable collection of widgets has been setup, simply reloading after selecting different molecule and metadata records will update all charts in reference to the current record.

Each type of chart widgets expect a different set of outputs. Example scripts are provided for all chart types on creation to illustrate the outputs required and how they can be used. The entire framework relies on the [script parameter](https://imagej.net/Script_Parameters) harvesting mechanism provided with ImageJ.

Below are a series of scripts to illustrate some of the common charts that can be created for evaluation of single-molecule observations.

### MoleculeArchive Dashboard

One powerful way to study molecules is to calculate paramters that report on the features of molecules. For example, if the archive has been generated by tracking motion, it is useful to evaluate the mean squared displacement. This metric provides a single number estimate of the amount of distance traveled by each molecule.

If you have complete the let's make an archive tutorial and the mean sqaured displacement tutorial, you already have an archive you can use with the script below. Here we will make a histogram of msd for all molecules in the archive in the global archive dashboard.

To begin, click on the histogram icon on the widget dashboard toolbar. This will add a histogram widget to the dashboard pane. Next, click select the script tab <>. Here we see an example script that generates three histograms using a random number generator. If you would like to see this example, click the reload icon on the far right and and histogram tab to see the result.

Now add our new custom parameter chart by replacing the example script with the one below. At this point you probably noticed it is hard to work in the script pane with the widget so small. If you place the cursor over the edges you can expand the widget's height and width until it is a comfortable size.

```python
#@ MoleculeArchive archive
#@OUTPUT String xlabel
#@OUTPUT String ylabel
#@OUTPUT String title
#@OUTPUT Integer bins
#@OUTPUT Double xmin
#@OUTPUT Double xmax
# Set global outputs

xlabel = "Position"
ylabel = "Frequency"
title = "Histogram"
bins = 100
xmin = 0.0
xmax = 5000.0

# Series 1 Outputs
#@OUTPUT Double[] series1_values
#@OUTPUT String series1_strokeColor
#@OUTPUT Integer series1_strokeWidth

series1_strokeColor = "black"
series1_strokeWidth = 2

series1_values = []

for molecule in archive.molecules().iterator():
    series1_values.append(molecule.getParameter("msd"))
```
Now if you click the reload button and go to the histogram tab you should see a histogram of MSD values for all molecules. Note that you have to choose the xmin and xmax appropriately for your range. If your not sure you could also use the min and max values of the series1_values array. We will leave this as a exercise for you to complete on your own.

Next let's take a look at the bubble chart. This can provide a way to plot one feature of a molecule against another. For example, we could ask the question: are longer tracks associated with higher msd values? To address that questions we could plot msd vs track length. As a further step we could add the UID numbers of each molecule record as a tooltip in case we want to quickly go and look at some of the outliners.

```groovy
#@ MoleculeArchive archive
#@OUTPUT String xlabel
#@OUTPUT String ylabel
#@OUTPUT String title
#@OUTPUT Double xmin
#@OUTPUT Double xmax
#@OUTPUT Double ymin
#@OUTPUT Double ymax

# Set global outputs
xlabel = "slices"
ylabel = "MSD"
title = "Bubble chart"

xmin = 0.0
xmax = 150
ymin = 0.0
ymax = 5000.0

# Series 1 Outputs
#@OUTPUT Double[] series1_xvalues
#@OUTPUT Double[] series1_yvalues
#@OUTPUT Double[] series1_size
#@OUTPUT String[] series1_label
#@OUTPUT String[] series1_color
#@OUTPUT String series1_markerColor

series1_markerColor = "lightgreen"

series1_xvalues = []
series1_yvalues = []
series1_size = []
series1_color = []
series1_label = []

for molecule in archive.molecules().iterator():
	series1_xvalues.append(molecule.getDataTable().getRowCount())
	series1_yvalues.append(molecule.getParameter("msd"))
	series1_size.append(4.0)
	series1_color.append("blue")
	series1_label.append(molecule.getUID())  
```
We already notice some very interesting trends...
